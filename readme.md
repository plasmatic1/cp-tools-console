# CP-Tools Console Version

!!! Module has not been published to PyPl !!!

Run `python3 setup.py develop` to install the module in development mode.

Module currently supports `>=Python 3.7` on both Windows and Linux based systems.  However, module has not been tested with `Python 3.8` yet.

# General Workflow

Test data is stored in `.yml` files, which can be easily modified to add/remove test cases.  Example:

```
checker: tokens
cases:
  - in: |
      5 5
      1 3 -8 -2 4
    out: |
      8
  - in: |
      6 2
      0 1 8 1 5 5
    out: |
      10
```

For the checker field, the currently available checkers are:

- `identical`: Identical
- `tokens` (the default): Compares tokenized versions of the expected and actual outputs
- `float:<eps>`: Tokenizes the strings, and then attempts to convert them to floating-point numbers and compare them with a given epsilon value.  Example: `float:1e-4`
- `custom:<path_to_source>`: Custom checker that allows the use of custom code to check the solution.  Path should be absolute
or relative to the current working directory.  File extension should be supported by an executor (i.e. `.cpp` files are supported by default)
    - Custom checker programs will be passed the input in `argv[1]`, the expected output in `argv[2]`, and the actual output in
    `argv[3]`




# Basic Commands

Arguments (both required and optional) can be seen by running `<command> --help`

- `cptools-run`
    - Aliases: `cprun`, `cpr`
    - Runs a given source file (compiling if necessary) on a set of test data.
- `cptools-companion-server`
    - Aliases: `cpserv`
    - Opens a HTTP server to listen for requests from `competitive-companion`
        - Automatically uses those to create data files for sample in/output along with source files from a template (optional)
    - Note: If on linux, the companion listener also creates shebangs for both input and source files and `chmods`s them so that they are directly executable

## Stress Testing

Automatic stress-testing is also available with the ...

TODO
   
# Configuration

Workspace-level configuration is available at `.cptools/config.yml` in the current workspace.  This file is automatically generated 
when a command is run if the file does not exist already.

To reset the config, simply delete the file and run a command.

## Executors

Executors are defined in a `.cptools/executors.yml` file in the current workspace.  If it does not exist, a default one will be generated
and used.  The default executors file can be seen in the repository under `cptools/local_data/default_executors.yml`.

Note: Leaving `compiled.exe_format` as `{src_name}.exe` still works fine on Linux based systems.

The executor format is as follows:

### For Compiled Languages

```
cpp-debug:
  ext: ['cpp', 'cxx', 'cc']
  compiled:
    command: ['g++', '-DLOCAL', '-Wall', '-Wshift-overflow=2', '-D_GLIBCXX_DEBUG', '-D_GLIBCXX_DEBUG_PEDANTIC', '-D_FORTIFY_SOURCE=2', '-fsanitize=address', '-fsanitize=undefined', '-fno-sanitize-recover', '-fstack-protector', '-o', '{exe_path}', '{src_path}']
    exe_format: '{src_name}.exe'
  command: ['./{exe_path}']
```

- `ext`: File extensions that this executor supports
    - Also used when determining the default executor for a source file
- `compiled`:
    - `command`: Compilation command
    - `exe_format`: Format for the 
- `command`: Command used to run the source file

### For Interpreted Languages

```
py:
  ext: ['py']
  command: ['python3', '{src_path}']
```

- `ext`: File extensions that this executor supports
    - Also used when determining the default executor for a source file
- `command`: Command used to run the source file

### Format Substitutions

Substitutions are also available for the `compiled.command`, `command`, and `compiled.exe_format` options.  These substitutions
use the `str.format` method with the following keyword substitutions.

- `src_path`: Path to the source file
- `src_name`: `src_path` but without the file extension
- `exe_path`: Path to the executable file
    - Value of the `compiled.exe_format` option after performing substitutions
    - Equal to `src_path` for interpreted languages

## TODO List

- Retrieving previous results
    - `cptools-view`
        - Options:
            - `-p --prev`: Look at previous result only
            - `-l --list`: List all results stored
            - `-c --clear`: Clear previous results
            - `-i --id <id>`: ID
- autogenerating files (functionality already partially exits with the companion listener...)
    - i.e. Task files (A,B,C,D,...)
    - `cptools-make <name>`
        - Aliases: `cpmake`, `cpm`
        - `-s --gen-src` - Make source files
        - `-ul --use-letters` - Name 
        
